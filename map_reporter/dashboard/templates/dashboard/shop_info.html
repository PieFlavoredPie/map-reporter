{% extends "dashboard_base.html" %}
{% load static %}

{% block headEnd %}
    <style>

    label {
        padding: 5px;
    }

    #shops-table_wrapper{
        padding:5px;
    }

    </style>
{% endblock %}


{% block main %}

<h1 class="mb-4">
    {{ shop.name }}
</h1>

<div class="card mb-4">
    <div class="card-header mb-4">
        <i class="fas fa-table"></i>
        Προϊόντα του {{ shop.name }}
    </div>
    <div class="card-body">
        <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle" type="button" id="print-selector" data-bs-toggle="dropdown" aria-expanded="false">
              Τύπος Εξαγωγής
            </button>
            <ul class="dropdown-menu" aria-labelledby="print-selector" id="shops-table_print-dropdown">
              <li><a class="dropdown-item" area-value="" href="#">Εξαγωγή σελίδας</a></li>
              <li><a class="dropdown-item" area-value="all" href="#">Εξαγωγή όλων</a></li>
              <li><a class="dropdown-item" area-value="selected" href="#">Εξαγωγή επιλεγμένων</a></li>
            </ul>
        </div>
        <table id='shops-table'
        data-toggle="table" 
        data-show-columns="true" 
        data-show-columns-toggle-all="true" 
        data-pagination="true" 
        data-show-toggle="true" 
        data-show-fullscreen="true" 
        data-buttons="buttons" 
        data-buttons-align="left" 
        data-buttons-class="primary" 
        data-pagination-v-align="both" 
        data-remember-order="true" 
        data-sort-reset="true" 
        data-filter-control="true" 
        data-show-search-clear-button="true" 
        data-show-multi-sort="true" 
        data-show-export="true" 
        data-show-print="true" 
        data-sticky-header="true">
            <thead>
                <tr class="bg-light">
                    <th data-field="product_name" data-sortable="true" data-filter-control="input">Προϊόν</th>
                    <th data-field="map_price" data-sortable="true">Τιμή MAP</th>
                    <th data-field="key_acc_price" data-sortable="true">Τιμή Key Account</th>
                    <th data-field="main_category" data-sortable="true" data-filter-control="select">Κατηγορία</th>
                </tr>
            </thead>
            <tbody>
                {% for product in products %}
                <tr>
                    <td>
                    <a href="{% url 'product_info' product.id %}">{{product}}</a>
                    </td>
                    <td>
                    <p>{{product.map_price}} €</p>
                    </td>
                    <td>
                    <p>{{product.key_acc_price}} €</p>
                    </td>
                    <td>
                    <p>{{product.main_category}}</p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>


<script>

    
 //top table
 var $shops_table = $('#shops-table');

 $(function() {
     $('#shops-table_print-dropdown').find('.dropdown-item').on('click', function (e) {
         e.preventDefault();
         selector_btn = document.getElementById('print-selector');
         selector_btn.innerText = e.target.innerText; 
         data = {};
         if (e.target.attributes['area-value'].value == 'selected'){
             data = {
                 field: 'state',
                 checkbox: true,
                 visible: $(this).attr('area-value') === 'selected'
             };
         }
         $shops_table.bootstrapTable('destroy').bootstrapTable({
             exportDataType: $(this).attr('area-value'),
             exportTypes: ['csv', 'txt', 'excel', 'pdf'],
             columns: [
                 data,
             ],
         })
         }).trigger('change')
        });

        $(window).on('load', ()=>{
            export_btn_group = $('.export.btn-group');
            exoport_dropdown = export_btn_group.find("[aria-label='Export']");
            exoport_dropdown.parent().css("cursor", "not-allowed");
            exoport_dropdown.each( (index, elements) => {
                $(elements).attr("disabled", "true");
            });
        });
</script>
{% endblock %}